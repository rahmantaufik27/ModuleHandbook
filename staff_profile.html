<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .profile-container {
            display: flex;
            align-items: flex-start;
            margin-top: 30px;
        }
        .profile-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 2px solid #007BFF;
            overflow: hidden;
            flex-shrink: 0;
        }
        .profile-info {
            margin-left: 20px;
            max-width: calc(100% - 170px);
        }
        .profile-info ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .profile-info ul li {
            margin-bottom: 10px;
        }
        .profile-info ul li strong {
            color: #007BFF;
        }
        .section-title {
            color: #007BFF;
            margin-top: 30px;
            margin-bottom: 15px;
            border-bottom: 2px solid #007BFF;
            display: inline-block;
        }
        .table-striped th, .table-striped td {
            vertical-align: top;
        }
    </style>
    <title>Staff Profile</title>
</head>
<body>
<div class="container">
    <div class="profile-container">
        <div id="profile-photo" class="profile-photo"></div>
        <div id="profile-info" class="profile-info">
            <ul id="profile-details"></ul>
        </div>
    </div>
    <div id="sinta-info" class="mt-4">
        <h3 class="section-title">SINTA Information</h3>
    </div>
    <div id="gs-info" class="mt-4">
        <h3 class="section-title">Google Scholar Information</h3>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var nidn = new URLSearchParams(window.location.search).get('nidn');
        var profileUrl = 'staff_handbook.php?nidn=' + nidn;

        fetch(profileUrl)
            .then(response => response.json())
            .then(data => {
                var profileInfo = document.getElementById('profile-details');
                if (data) {
                    document.getElementById('profile-photo').innerHTML = '<img src="' + (data["PHOTO"] || 'default-photo.jpg') + '" alt="Profile Photo" class="img-fluid">';
                    profileInfo.innerHTML = `
                        <li><strong>Name:</strong> ${data["NAME"]}</li>
                        <li><strong>NIDN:</strong> ${data["NIDN"]}</li>
                        <li><strong>Position:</strong> ${data["POSITION"]}</li>
                        <li><strong>Academic Career:</strong> ${data["ACADEMIC CAREER"]}</li>
                        <li><strong>Education:</strong>
                            <ul>
                                <li><strong>Bachelor:</strong> ${data["Pendidikan S1"]} (Year: ${data["Tahun Lulus S1"]})</li>
                                <li><strong>Master:</strong> ${data["Pendidikan S2"]} (Year: ${data["Tahun Lulus S2"]})</li>
                                <li><strong>Doctorate:</strong> ${data["Pendidikan S3"] || '-'} (Year: ${data["Tahun Lulus S3"] || '-'})</li>
                            </ul>
                        </li>
                    `;

                    if (data["SINTA ID"]) {
                        fetchSintaData(data["SINTA ID"]);
                    }

                    if (data["GS ID"]) {
                        fetchGSData(data["GS ID"]);
                    }
                } else {
                    profileInfo.innerHTML = '<div class="alert alert-danger">Profile not found.</div>';
                }
            })
            .catch(error => console.error('Error:', error));
    });

    function fetchSintaData(sid) {
        var sintaInfo = document.getElementById("sinta-info");

        fetch('https://ilkom.unila.ac.id/site/asiin/sinta_api.php?sid=' + sid + '&type=summary')
            .then(response => response.json())
            .then(data => {
                var summaryHtml = `
                    <h4 class="section-title">SINTA Summary</h4>
                    <ul>
                        <li><strong>Scopus</strong>
                            <ul>
                                <li>Articles: ${data.summary.Scopus.Article}</li>
                                <li>Citations: ${data.summary.Scopus.Citation}</li>
                                <li>Cited Documents: ${data.summary.Scopus["Cited Document"]}</li>
                                <li>H-Index: ${data.summary.Scopus["H-Index"]}</li>
                                <li>i10-Index: ${data.summary.Scopus["i10-Index"]}</li>
                                <li>G-Index: ${data.summary.Scopus["G-Index"]}</li>
                            </ul>
                        </li>
                        <li><strong>Google Scholar</strong>
                            <ul>
                                <li>Articles: ${data.summary.GScholar.Article}</li>
                                <li>Citations: ${data.summary.GScholar.Citation}</li>
                                <li>Cited Documents: ${data.summary.GScholar["Cited Document"]}</li>
                                <li>H-Index: ${data.summary.GScholar["H-Index"]}</li>
                                <li>i10-Index: ${data.summary.GScholar["i10-Index"]}</li>
                                <li>G-Index: ${data.summary.GScholar["G-Index"]}</li>
                            </ul>
                        </li>
                        <li><strong>WOS</strong>
                            <ul>
                                <li>Articles: ${data.summary.WOS.Article}</li>
                                <li>Citations: ${data.summary.WOS.Citation}</li>
                                <li>Cited Documents: ${data.summary.WOS["Cited Document"]}</li>
                                <li>H-Index: ${data.summary.WOS["H-Index"]}</li>
                                <li>i10-Index: ${data.summary.WOS["i10-Index"]}</li>
                                <li>G-Index: ${data.summary.WOS["G-Index"]}</li>
                            </ul>
                        </li>
                    </ul>
                `;
                sintaInfo.innerHTML += summaryHtml;
            });
    }

    function fetchGSData(gsId) {
        var gsInfo = document.getElementById("gs-info");

        fetch('https://ilkom.unila.ac.id/site/asiin/gs_api.php?user=' + gsId + '&sortby=pubdate')
            .then(response => response.json())
            .then(data => {
                var last5Html = `
                    <h4 class="section-title">Last Publications</h4>
                    <ul>
                        ${data.map(item => `
                            <li><strong>${item.title}</strong> (${item.authors}) - ${item.publisher}, ${item.year} (Cited: ${item.cited})</li>
                        `).join('')}
                    </ul>
                `;
                gsInfo.innerHTML += last5Html;

                fetch('https://ilkom.unila.ac.id/site/asiin/gs_api.php?user=' + gsId + '&sortby=citations')
                    .then(response => response.json())
                    .then(data => {
                        var topCitedHtml = `
                            <h4 class="section-title">Top 5 Most Cited Publications</h4>
                            <ul>
                                ${data.slice(0, 5).map(item => `
                                    <li><strong>${item.title}</strong> (${item.authors}) - ${item.publisher}, ${item.year} (Cited: ${item.cited})</li>
                                `).join('')}
                            </ul>
                        `;
                        gsInfo.innerHTML += topCitedHtml;
                    })
                    .catch(error => console.error('Error fetching top cited publications:', error));
            });
    }
</script>
</body>
</html>
