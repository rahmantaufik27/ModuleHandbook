<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            font-size: 14px;
        }
        .profile-container {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        .profile-photo img {
            width: 250px;
            height: 250px;
            border-radius: 15%;
            border: 2px solid #adb5bd;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .profile-info {
            margin-left: 20px;
            flex-grow: 1;
        }
        .section-title {
            margin-top: 30px;
            margin-bottom: 15px;
            color: #007bff;
        }
        .table th, .table td {
            vertical-align: middle;
        }
        .table th {
            width: 150px;
            color: #495057;
        }
        .table {
            background-color: white;
        }
    </style>
    <title>Staff Profile</title>
</head>
<body>
<div class="container mt-5">
    <div class="profile-container">
        <div id="profile-photo" class="profile-photo"></div>
        <div id="profile-info" class="profile-info"></div>
    </div>
    <div id="sinta-info" class="mt-4">
        <h3 class="section-title">Staff Performance</h3>
    </div>
    <div id="gs-info" class="mt-4">
        <h3 class="section-title">Publications</h3>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var nidn = new URLSearchParams(window.location.search).get('nidn');
        var profileUrl = 'staff_handbook.php?nidn=' + nidn;

        fetch(profileUrl)
            .then(response => response.json())
            .then(data => {
                var profileInfo = document.getElementById('profile-info');
                if (data) {
                    profileInfo.innerHTML = '<table class="table table-bordered">' +
                        '<tr><th>Name</th><td>' + data["NAME"] + '</td></tr>' +
                        '<tr><th>NIDN</th><td>' + data["NIDN"] + '</td></tr>' +
                        '<tr><th>Position</th><td>' + data["POSITION"] + '</td></tr>' +
                        '<tr><th>Academic Career</th><td>' + data["ACADEMIC CAREER"] + '</td></tr>' +
                        '<tr><th>Education</th><td>' +
                        '<strong>Bachelor:</strong> ' + data["Pendidikan S1"] + ' (Year: ' + data["Tahun Lulus S1"] + ')<br>' +
                        '<strong>Master:</strong> ' + data["Pendidikan S2"] + ' (Year: ' + data["Tahun Lulus S2"] + ')<br>' +
                        '<strong>Doctorate:</strong> ' + (data["Pendidikan S3"] || '-') + ' (Year: ' + (data["Tahun Lulus S3"] || '-') + ')' +
                        '</td></tr>' +
                        '</table>';

                    if (data["SINTA ID"]) {
                        fetchSintaData(data["SINTA ID"]);
                    }

                    if (data["GS ID"]) {
                        fetchGSData(data["GS ID"]);
                    }
                } else {
                    profileInfo.innerHTML = '<div class="alert alert-danger">Profile not found.</div>';
                }
            })
            .catch(error => console.error('Error:', error));
    });

    function fetchSintaData(sid) {
        var sintaInfo = document.getElementById("sinta-info");

        fetch('https://ilkom.unila.ac.id/site/asiin/sinta_api.php?sid=' + sid + '&type=summary')
            .then(response => response.json())
            .then(data => {
                var profilePhoto = document.getElementById('profile-photo');
                if (data.profile_image) {
                    profilePhoto.innerHTML = '<img src="' + data.profile_image + '" alt="Profile Photo" class="img-fluid">';
                } else {
                    profilePhoto.innerHTML = 'Photo not available';
                }

                var summaryHtml = "<h4>SINTA Summary</h4><table class='table table-striped'><thead><tr><th>Scopus</th><th>GScholar</th><th>WOS</th></tr></thead><tbody>";
                summaryHtml += "<tr><td>Articles: " + data.summary.Scopus.Article + "<br>Citations: " + data.summary.Scopus.Citation + "<br>Cited Documents: " + data.summary.Scopus["Cited Document"] + "<br>H-Index: " + data.summary.Scopus["H-Index"] + "<br>i10-Index: " + data.summary.Scopus["i10-Index"] + "<br>G-Index: " + data.summary.Scopus["G-Index"] + "</td>";
                summaryHtml += "<td>Articles: " + data.summary.GScholar.Article + "<br>Citations: " + data.summary.GScholar.Citation + "<br>Cited Documents: " + data.summary.GScholar["Cited Document"] + "<br>H-Index: " + data.summary.GScholar["H-Index"] + "<br>i10-Index: " + data.summary.GScholar["i10-Index"] + "<br>G-Index: " + data.summary.GScholar["G-Index"] + "</td>";
                summaryHtml += "<td>Articles: " + data.summary.WOS.Article + "<br>Citations: " + data.summary.WOS.Citation + "<br>Cited Documents: " + data.summary.WOS["Cited Document"] + "<br>H-Index: " + data.summary.WOS["H-Index"] + "<br>i10-Index: " + data.summary.WOS["i10-Index"] + "<br>G-Index: " + data.summary.WOS["G-Index"] + "</td>";
                summaryHtml += "</tr></tbody></table>";
                sintaInfo.innerHTML += summaryHtml;

                // Fetch subsequent data sequentially
                fetchResearchData(sid);
            });

    }

    function fetchResearchData(sid) {
        var sintaInfo = document.getElementById("sinta-info");

        fetch('https://ilkom.unila.ac.id/site/asiin/sinta_api.php?sid=' + sid + '&type=research')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                if (data && data.length > 0) {
                    var researchHtml = "<h4>Research</h4><table class='table table-striped'><thead><tr><th>Title</th><th>Leader</th><th>Members</th><th>Funding Source</th><th>Year</th><th>Amount</th></tr></thead><tbody>";
                    data.forEach(item => {
                        var members = Object.values(item.members).join(", ");
                        researchHtml += "<tr><td>" + item.title + "</td><td>" + item.leader.replace('Leader : ', '') + "</td><td>" + members + "</td><td>" + item.funding_source + "</td><td>" + item.year + "</td><td>" + item.amount + "</td></tr>";
                    });
                    researchHtml += "</tbody></table>";
                    sintaInfo.innerHTML += researchHtml;
                } else {
                    sintaInfo.innerHTML += '<div class="alert alert-warning">No Research data available.</div>';
                }
                // Fetch subsequent data sequentially
                fetchCommunityServiceData(sid);
            })
            .catch(error => {
                console.error('Error fetching Research data:', error);
                sintaInfo.innerHTML += '<div class="alert alert-danger">Failed to load Research data. Please try again later.</div>';
            });
    }

    function fetchCommunityServiceData(sid) {
        var sintaInfo = document.getElementById("sinta-info");

        fetch('https://ilkom.unila.ac.id/site/asiin/sinta_api.php?sid=' + sid + '&type=cs')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                if (data && data.length > 0) {
                    var csHtml = "<h4>Community Services</h4><table class='table table-striped'><thead><tr><th>Title</th><th>Leader</th><th>Members</th><th>Funding Source</th><th>Year</th><th>Amount</th></tr></thead><tbody>";
                    data.forEach(item => {
                        var members = Object.values(item.members).join(", ");
                        csHtml += "<tr><td>" + item.title + "</td><td>" + item.leader.replace('Leader : ', '') + "</td><td>" + members + "</td><td>" + item.funding_source + "</td><td>" + item.year + "</td><td>" + item.amount + "</td></tr>";
                    });
                    csHtml += "</tbody></table>";
                    sintaInfo.innerHTML += csHtml;
                } else {
                    sintaInfo.innerHTML += '<div class="alert alert-warning">No Community Services data available.</div>';
                }
                // Fetch subsequent data sequentially
                fetchIPRData(sid);
            })
            .catch(error => {
                console.error('Error fetching Community Services data:', error);
                sintaInfo.innerHTML += '<div class="alert alert-danger">Failed to load Community Services data. Please try again later.</div>';
            });
    }

    function fetchIPRData(sid) {
        var sintaInfo = document.getElementById("sinta-info");

        fetch('https://ilkom.unila.ac.id/site/asiin/sinta_api.php?sid=' + sid + '&type=ipr')
            .then(response => response.json())
            .then(data => {
                var iprHtml = "<h4>Intellectual Property Rights (IPR)</h4><table class='table table-striped'><thead><tr><th>Title</th><th>Inventors</th><th>Year</th><th>Application Number</th><th>Type</th></thead><tbody>";
                data.forEach(item => {
                    iprHtml += "<tr><td>" + item.title + "</td><td>" + item.inventors + "</td><td>" + item.year + "</td><td>" + item.application_number + "</td><td>" + item.ipr_type + "</td></tr>";
                });
                iprHtml += "</tbody></table>";
                sintaInfo.innerHTML += iprHtml;
                
                // Fetch subsequent data sequentially
                fetchBooksData(sid);
            });
    }

    function fetchBooksData(sid) {
        var sintaInfo = document.getElementById("sinta-info");

        fetch('https://ilkom.unila.ac.id/site/asiin/sinta_api.php?sid=' + sid + '&type=books')
            .then(response => response.json())
            .then(data => {
                var booksHtml = "<h4>Books</h4><table class='table table-striped'><thead><tr><th>Title</th><th>Author</th><th>Publisher</th><th>Year</th><th>City</th><th>ISBN</th></tr></thead><tbody>";
                data.forEach(item => {
                    booksHtml += "<tr><td>" + item.title + "</td><td>" + item.author + "</td><td>" + item.publisher + "</td><td>" + item.year + "</td><td>" + item.city + "</td><td>" + item.isbn + "</td></tr>";
                });
                booksHtml += "</tbody></table>";
                sintaInfo.innerHTML += booksHtml;

                // Fetch subsequent data sequentially
                fetchScopusArticlesData(sid);
            });
    }

    function fetchScopusArticlesData(sid) {
        var sintaInfo = document.getElementById("sinta-info");

        fetch('https://ilkom.unila.ac.id/site/asiin/sinta_api.php?sid=' + sid + '&type=scopus')
            .then(response => response.json())
            .then(data => {
                var scopusHtml = "<h4>Scopus Articles</h4><table class='table table-striped'><thead><tr><th>Title</th><th>Author Order</th><th>Quartile</th><th>Publisher</th><th>Year</th><th>Citations</th></thead><tbody>";
                data.forEach(item => {
                    scopusHtml += "<tr><td>" + item.title + "</td><td>" + item.author_order + "</td><td>" + item.quartile + "</td><td>" + item.publisher + "</td><td>" + item.year + "</td><td>" + item.cited + "</td></tr>";
                });
                scopusHtml += "</tbody></table>";
                sintaInfo.innerHTML += scopusHtml;
            });
    }

    function fetchGSData(gsId) {
        var gsInfo = document.getElementById("gs-info");

        fetch('https://ilkom.unila.ac.id/site/asiin/gs_api.php?user=' + gsId + '&sortby=pubdate')
            .then(response => response.json())
            .then(data => {
                var last5Html = "<h4>Last Publications</h4><table class='table table-striped'><thead><tr><th>Title</th><th>Authors</th><th>Publisher</th><th>Year</th><th>Citations</th></thead><tbody>";
                data.forEach(item => {
                    last5Html += "<tr><td>" + item.title + "</td><td>" + item.authors + "</td><td>" + item.publisher + "</td><td>" + item.year + "</td><td>" + item.cited + "</td></tr>";
                });
                last5Html += "</tbody></table>";
                gsInfo.innerHTML += last5Html;

                fetch('https://ilkom.unila.ac.id/site/asiin/gs_api.php?user=' + gsId + '&sortby=citations')
                .then(response => response.json())
                .then(data => {
                    var topCitedHtml = "<h4>Top 5 Most Cited Publications</h4><table class='table table-striped'><thead><tr><th>Title</th><th>Authors</th><th>Publisher</th><th>Year</th><th>Citations</th></tr></thead><tbody>";

                    // Use slice to limit the data to the first 5 items
                    data.slice(0, 5).forEach(item => {
                        topCitedHtml += "<tr><td>" + item.title + "</td><td>" + item.authors + "</td><td>" + item.publisher + "</td><td>" + item.year + "</td><td>" + item.cited + "</td></tr>";
                    });

                    topCitedHtml += "</tbody></table>";
                    gsInfo.innerHTML += topCitedHtml;
                })
                .catch(error => console.error('Error fetching top cited publications:', error));
            });
    }
</script>
</body>
</html>
